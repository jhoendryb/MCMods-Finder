<!DOCTYPE html>
<html lang="es" data-bs-theme="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minecraft Mods Finder</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <link rel="stylesheet" href="src/css/index.css">
</head>

<body>
    <div class="container py-5">
        <div class="text-center mb-4">
            <div class="logo">Minecraft Mods Finder</div>
            <p class="subtitle">Encuentra los mejores mods de Minecraft en un solo lugar</p>
        </div>

        <div class="search-container">
            <div class="input-group mb-4">
                <span class="input-group-text bg-transparent text-white border-end-0">
                    <i class="bi bi-search"></i>
                </span>
                <input type="text" class="form-control search-input" id="searchInput"
                    placeholder="Busca mods de Minecraft...">
                <button class="btn btn-outline-secondary" type="button" id="searchButton">
                    <span class="spinner-border spinner-border-sm d-none" id="loadingSpinner" role="status"
                        aria-hidden="true"></span>
                    <span id="buttonText">Buscar</span>
                </button>
            </div>

            <div class="row result-section">
                <div class="col-md-6">
                    <h3 class="section-title">
                        <i class="bi bi-modem"></i> Modrinth
                    </h3>
                    <div id="result-modrinth" class="row">
                        <div class="col-12 text-center py-5">
                            <i class="bi bi-box-seam" style="font-size: 3rem; opacity: 0.3;"></i>
                            <p class="mt-2">Los resultados de Modrinth aparecerán aquí</p>
                        </div>
                    </div>
                </div>

                <div class="col-md-6">
                    <h3 class="section-title">
                        <i class="bi bi-hammer"></i> CurseForge
                    </h3>
                    <div id="result-forge" class="row">
                        <div class="col-12 text-center py-5">
                            <i class="bi bi-box-seam" style="font-size: 3rem; opacity: 0.3;"></i>
                            <p class="mt-2">Los resultados de CurseForge aparecerán aquí</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="mt-5">
                <h3 class="section-title">
                    <i class="bi bi-chat-square-text"></i> Comentarios Recientes
                    <small class="text-muted ms-2">(Búsqueda automática de compatibilidad servidor)</small>
                </h3>
                <div id="result-commentForge">
                    <div class="text-center py-5">
                        <i class="bi bi-chat-square-text" style="font-size: 3rem; opacity: 0.3;"></i>
                        <p class="mt-2">Los comentarios de los mods seleccionados aparecerán aquí</p>
                        <p class="small text-muted mt-2">Se buscan automáticamente comentarios que mencionen
                            compatibilidad con servidores</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Sección de comparación de mods -->
    <div class="container py-4">
        <div class="card bg-dark text-white">
            <div class="card-header">
                <h3 class="mb-0">
                    <i class="bi bi-folder2-open"></i> Comparar Mods Locales
                </h3>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <label for="modsFolder" class="form-label">Seleccionar carpeta de mods (.jar):</label>
                    <input type="file" class="form-control" id="modsFolder" webkitdirectory directory multiple
                        accept=".jar">
                    <div class="form-text">Selecciona la carpeta que contiene tus archivos .jar de Minecraft</div>
                </div>

                <div id="modsComparison" class="row mt-4 d-none">
                    <div class="col-md-4">
                        <div class="card h-100">
                            <div class="card-header bg-secondary">
                                <h5 class="mb-0">Mods Locales</h5>
                            </div>
                            <div class="card-body p-0">
                                <div id="localModsList" class="list-group list-group-flush"
                                    style="max-height: 500px; overflow-y: auto;"></div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-8">
                        <div class="card h-100">
                            <div class="card-header bg-secondary d-flex justify-content-between align-items-center">
                                <h5 class="mb-0">Resultados de Búsqueda</h5>
                                <span id="searchingSpinner" class="spinner-border spinner-border-sm d-none"
                                    role="status">
                                    <span class="visually-hidden">Buscando...</span>
                                </span>
                            </div>
                            <div class="card-body p-0">
                                <div id="searchResults" class="list-group list-group-flush"
                                    style="max-height: 500px; overflow-y: auto;">
                                    <div class="text-center p-5 text-muted">
                                        <i class="bi bi-search" style="font-size: 2rem;"></i>
                                        <p class="mt-2">Selecciona un mod de la lista para ver los resultados</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para detalles del mod -->
    <div class="modal fade" id="modDetailsModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content bg-dark text-white">
                <div class="modal-header border-secondary">
                    <h5 class="modal-title" id="modDetailsTitle">Detalles del Mod</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                        aria-label="Close"></button>
                </div>
                <div class="modal-body" id="modDetailsBody">
                    <div class="text-center py-4">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Cargando...</span>
                        </div>
                    </div>
                </div>
                <div class="modal-footer border-secondary">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                    <a href="#" id="modDownloadLink" class="btn btn-primary" target="_blank">
                        <i class="bi bi-download"></i> Descargar
                    </a>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="src/js/api/itemsModrinth.js"></script>
    <script src="src/js/api/itemsForge.js"></script>
    <script src="src/js/api/searchCF.js"></script>
    <script src="src/js/utils.js"></script>
    <script src="src/js/api/apiTempletes.js"></script>
    <script src="src/js/api/apiModrinth.js"></script>

    <script>
        function showLoading(show) {
            const spinner = document.getElementById('loadingSpinner');
            const buttonText = document.getElementById('buttonText');

            if (show) {
                spinner.classList.remove('d-none');
                buttonText.textContent = 'Buscando...';
            } else {
                spinner.classList.add('d-none');
                buttonText.textContent = 'Buscar';
            }
        }

        function createModCard(mod, source) {
            const card = document.createElement('div');
            card.className = 'col-12 mb-3';

            // Determinar los iconos para client_side y server_side
            const clientIcon = mod.client_side === 'required' ? 'bi-check-circle-fill' :
                mod.client_side === 'optional' ? 'bi-circle' :
                    'bi-x-circle-fill';
            const serverIcon = mod.server_side === 'required' ? 'bi-check-circle-fill' :
                mod.server_side === 'optional' ? 'bi-circle' :
                    'bi-x-circle-fill';

            // Colores para los iconos
            const clientColor = mod.client_side === 'required' ? 'success' :
                mod.client_side === 'optional' ? 'warning' :
                    'danger';
            const serverColor = mod.server_side === 'required' ? 'success' :
                mod.server_side === 'optional' ? 'warning' :
                    'danger';

            const isServerOrCliente = (source === 'Modrinth') ? `
                <div class="d-flex align-items-center">
                    <span class="badge bg-${clientColor} me-2">
                        <i class="bi ${clientIcon} me-1"></i>Cliente
                    </span>
                    <span class="badge bg-${serverColor}">
                        <i class="bi ${serverIcon} me-1"></i>Servidor
                    </span>
                </div>` : '';

            card.innerHTML = `
                <div class="mod-card">
                    <h4 class="mod-title">${mod.title}</h4>
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        ${isServerOrCliente}
                        <span class="badge bg-primary">${source}</span>
                    </div>
                    <div class="d-flex justify-content-end">
                        ${mod.url ? `<a href="${mod.url[0]}" target="_blank" class="btn btn-sm btn-view">
                            Ver <i class="bi bi-box-arrow-up-right ms-1"></i>
                        </a>` : ''}
                    </div>
                </div>
            `;

            return card;
        }

        function createComment(comment) {
            const commentDiv = document.createElement('div');
            commentDiv.className = 'comment-card';
            commentDiv.textContent = comment.text;
            return commentDiv;
        }

        function printJSONModrinth(data) {
            const container = document.getElementById("result-modrinth");
            container.innerHTML = '';

            if (data && data.length > 0) {
                data.forEach(mod => {
                    container.appendChild(createModCard(mod, 'Modrinth'));
                });
            } else {
                container.innerHTML = `
                    <div class="col-12 text-center py-3">
                        <p>No se encontraron resultados en Modrinth</p>
                    </div>
                `;
            }
        }

        function printJSONForge(data) {
            const container = document.getElementById("result-forge");
            container.innerHTML = '';

            if (data && data.length > 0) {
                data.forEach(mod => {
                    container.appendChild(createModCard(mod, 'CurseForge'));
                    // Buscar comentarios para el primer mod encontrado
                    if (mod.id) {
                        searchCF(`https://www.curseforge.com/api/v1/mods/${mod.id}/comments?size=5`, 'server')
                            .then(printJSONCommentForge);
                    }
                });
            } else {
                container.innerHTML = `
                    <div class="col-12 text-center py-3">
                        <p>No se encontraron resultados en CurseForge</p>
                    </div>
                `;
            }
        }

        function printJSONCommentForge(data) {
            const container = document.getElementById("result-commentForge");

            if (data && data.coincidences && data.coincidences.length > 0) {
                container.innerHTML = '';
                data.coincidences.slice(0, 5).forEach(comment => {
                    container.appendChild(createComment(comment));
                });
            } else if (container.children.length <= 1) {
                container.innerHTML = `
                    <div class="text-center py-3">
                        <p>No se encontraron comentarios recientes</p>
                    </div>
                `;
            }
        }


        function performSearch() {
            const searchInput = document.getElementById("searchInput");
            const searchTerm = searchInput.value.trim();

            if (searchTerm.length < 2) {
                return;
            }

            // Mostrar estado de carga
            showLoading(true);

            // Limpiar resultados anteriores
            document.getElementById("result-modrinth").innerHTML = '';
            document.getElementById("result-forge").innerHTML = '';
            document.getElementById("result-commentForge").innerHTML = '';

            // Realizar búsquedas en paralelo
            Promise.all([
                searchModrinth(searchTerm).then(printJSONModrinth),
                searchForge(searchTerm).then(printJSONForge)
            ]).finally(() => {
                showLoading(false);
            });
        }


        // Event Listeners
        document.addEventListener('DOMContentLoaded', function () {
            const searchInput = document.getElementById("searchInput");
            const searchButton = document.getElementById("searchButton");

            // Buscar al hacer clic en el botón
            searchButton.addEventListener("click", performSearch);

            // Buscar al presionar Enter en el input
            searchInput.addEventListener("keyup", function (event) {
                if (event.key === "Enter") {
                    performSearch();
                }
            });

            // Búsqueda con debounce para no hacer muchas llamadas mientras se escribe
            let searchTimeout;
            searchInput.addEventListener("input", function () {
                clearTimeout(searchTimeout);
                if (this.value.length > 2) {
                    searchTimeout = setTimeout(performSearch, 800);
                }
            });
        });

        // Variables globales para la comparación de mods
        let localMods = [];
        let searchResults = {};
        let selectedMod = null;

        // Inicialización de la funcionalidad de comparación
        document.addEventListener('DOMContentLoaded', function () {
            const modsFolderInput = document.getElementById('modsFolder');

            // Manejar selección de archivos
            modsFolderInput.addEventListener('change', async (event) => {
                const files = Array.from(event.target.files);
                const modsComparison = document.getElementById('modsComparison');

                console.log('Archivos seleccionados:', files.map(f => f.name)); // Debug

                // Filtrar solo archivos .jar (case insensitive)
                localMods = files
                    .filter(file => {
                        const fileName = file.name.toLowerCase();
                        const isJar = fileName.endsWith('.jar');
                        console.log(`Procesando archivo: ${file.name}, ¿es .jar?: ${isJar}`);
                        return isJar;
                    })
                    .map((file, index) => {
                        // Extraer el nombre sin la extensión .jar
                        const nameWithoutExt = file.name.replace(/\.jar$/i, '');
                        // Limpiar el nombre para mostrar
                        const cleanName = nameWithoutExt
                            .replace(/[_-]/g, ' ')  // Reemplazar guiones bajos y medios por espacios
                            .replace(/\./g, ' ')    // Reemplazar puntos por espacios
                            .replace(/\d+/g, ' ')   // Eliminar números
                            .replace(/\s+/g, ' ')   // Reemplazar múltiples espacios por uno solo
                            .trim();                // Eliminar espacios al inicio y final

                        console.log(`Archivo procesado: ${file.name} -> ${cleanName}`);

                        return {
                            id: `mod-${Date.now()}-${index}`,
                            name: cleanName,
                            originalName: file.name,  // Guardar el nombre original
                            fileName: file.name,
                            path: file.webkitRelativePath || file.name,
                            file: file
                        };
                    });

                console.log('Mods procesados:', localMods);

                if (localMods.length > 0) {
                    modsComparison.classList.remove('d-none');
                    await processLocalMods();
                } else {
                    alert('No se encontraron archivos .jar en la selección. Asegúrate de seleccionar archivos .jar');
                }
            });
        });

        // Procesar los mods locales
        async function processLocalMods() {
            const localModsList = document.getElementById('localModsList');
            const searchingSpinner = document.getElementById('searchingSpinner');
            localModsList.innerHTML = '';
            searchResults = {};

            // Mostrar los mods locales
            localMods.forEach((mod, index) => {
                const modElement = document.createElement('button');
                modElement.className = 'list-group-item list-group-item-action d-flex justify-content-between align-items-center';
                modElement.innerHTML = `
                    <span class="text-truncate" title="${mod.name}">${mod.name}</span>
                    <span class="badge bg-secondary">${mod.fileName}</span>
                `;
                modElement.dataset.modIndex = index;

                modElement.addEventListener('click', () => showSearchResults(index));
                localModsList.appendChild(modElement);
            });

            // Seleccionar el primer mod automáticamente
            if (localMods.length > 0) {
                showSearchResults(0);
            }
        }

        // Mostrar resultados de búsqueda para un mod
        async function showSearchResults(modIndex) {
            const mod = localMods[modIndex];
            selectedMod = modIndex;

            // Actualizar selección visual
            document.querySelectorAll('#localModsList .active').forEach(el => {
                el.classList.remove('active');
            });
            document.querySelector(`#localModsList [data-mod-index="${modIndex}"]`).classList.add('active');

            const searchResultsDiv = document.getElementById('searchResults');
            const searchingSpinner = document.getElementById('searchingSpinner');

            // Mostrar estado de carga
            searchResultsDiv.innerHTML = `
                <div class="text-center p-5">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Buscando...</span>
                    </div>
                    <p class="mt-2">Buscando "${mod.name}" en Modrinth...</p>
                </div>
            `;

            try {
                // Buscar en Modrinth
                const results = await modrinthApiParams("search", {
                    query: mod.name,
                    limit: 5,
                    facets: [["project_type:mod"]]
                });

                searchResults[modIndex] = results.hits || [];
                displaySearchResults(searchResults[modIndex]);
            } catch (error) {
                console.error('Error buscando mod:', error);
                searchResultsDiv.innerHTML = `
                    <div class="alert alert-danger m-3">
                        <i class="bi bi-exclamation-triangle-fill"></i> Error al buscar el mod: ${error.message}
                    </div>
                `;
            }
        }

        // Mostrar los resultados de búsqueda
        function displaySearchResults(results) {
            const searchResultsDiv = document.getElementById('searchResults');

            if (!results || results.length === 0) {
                searchResultsDiv.innerHTML = `
                    <div class="text-center p-5 text-muted">
                        <i class="bi bi-question-circle" style="font-size: 2rem;"></i>
                        <p class="mt-2">No se encontraron resultados para este mod</p>
                    </div>
                `;
                return;
            }

            searchResultsDiv.innerHTML = results.map((mod, index) => {
                // Determinar compatibilidad
                const compatibility = [];
                if (mod.client_side === 'required') compatibility.push('Cliente');
                if (mod.server_side === 'required') compatibility.push('Servidor');
                if (mod.client_side === 'optional' || mod.server_side === 'optional') compatibility.push('Opcional');

                // Determinar el color del borde según la compatibilidad
                let borderClass = '';
                if (mod.client_side === 'required' && mod.server_side === 'required') {
                    borderClass = 'border-primary border-2';
                } else if (mod.client_side === 'required') {
                    borderClass = 'border-success border-2';
                } else if (mod.server_side === 'required') {
                    borderClass = 'border-danger border-2';
                } else if (mod.client_side === 'optional' || mod.server_side === 'optional') {
                    borderClass = 'border-warning border-2';
                }

                return `
                <div class="list-group-item list-group-item-action p-0 overflow-hidden ${borderClass}" data-mod-id="${mod.project_id}" data-mod-index="${selectedMod}">
                    <div class="d-flex">
                        <!-- Barra lateral de compatibilidad -->
                        <div class="d-flex flex-column justify-content-between bg-dark p-2 text-center" style="min-width: 50px;">
                            ${mod.client_side === 'required' ?
                        '<div class="text-success mb-2" title="Cliente"><i class="bi bi-pc-display fs-4"></i></div>' :
                        mod.client_side === 'optional' ?
                            '<div class="text-warning mb-2" title="Cliente (Opcional)"><i class="bi bi-pc-display fs-4"></i></div>' :
                            '<div class="text-muted mb-2" title="No es necesario en cliente"><i class="bi bi-pc-display fs-4"></i><i class="bi bi-slash-circle text-danger"></i></div>'}
                            
                            ${mod.server_side === 'required' ?
                        '<div class="text-danger" title="Servidor"><i class="bi bi-hdd-rack fs-4"></i></div>' :
                        mod.server_side === 'optional' ?
                            '<div class="text-warning" title="Servidor (Opcional)"><i class="bi bi-hdd-rack fs-4"></i></div>' :
                            '<div class="text-muted" title="No es necesario en servidor"><i class="bi bi-hdd-rack fs-4"><i class="bi bi-slash-circle text-danger"></i></i></div>'}
                        </div>
                        
                        <!-- Contenido principal -->
                        <div class="p-3 flex-grow-1">
                            <div class="d-flex justify-content-between align-items-start">
                                <div class="me-3">
                                    <div class="d-flex align-items-center mb-1 flex-wrap">
                                        <h6 class="mb-0 me-2">${mod.title || 'Sin título'}</h6>
                                        ${mod.loader_categories?.includes('fabric') ? '<span class="badge bg-purple me-1">Fabric</span>' : ''}
                                        ${mod.loader_categories?.includes('forge') ? '<span class="badge bg-orange me-1">Forge</span>' : ''}
                                        <span class="badge bg-dark">${compatibility.join(' + ')}</span>
                                    </div>
                                    <p class="small text-muted mb-2">${mod.description ? mod.description.substring(0, 120) + '...' : 'Sin descripción'}</p>
                                    <div class="d-flex flex-wrap gap-1 align-items-center">
                                        ${mod.versions ? mod.versions.slice(0, 3).map(v =>
                                `<span class="badge bg-secondary">${v}</span>`
                            ).join('') : ''}
                                        ${mod.versions && mod.versions.length > 3 ?
                        `<span class="badge bg-dark">+${mod.versions.length - 3} más</span>` : ''}
                                    </div>
                                </div>
                                <div class="text-end">
                                    <div class="d-flex flex-column align-items-end">
                                        <span class="badge bg-primary mb-2">
                                            <i class="bi bi-download"></i> ${mod.downloads ? mod.downloads.toLocaleString() : '0'}
                                        </span>
                                        <button class="btn btn-sm btn-outline-primary view-details" data-mod-id="${mod.project_id}">
                                            <i class="bi bi-info-circle"></i> Detalles
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                    `}).join('');

            // Agregar manejadores de eventos para los botones de detalles
            document.querySelectorAll('.view-details').forEach(button => {
                button.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const modId = button.dataset.modId;
                    showModDetails(modId);
                });
            });

            // Hacer clic en toda la tarjeta para seleccionar el mod
            document.querySelectorAll('#searchResults > .list-group-item').forEach(item => {
                item.addEventListener('click', () => {
                    const modId = item.dataset.modId;
                    const modIndex = item.dataset.modIndex;
                    selectMod(modIndex, modId);
                });
            });
        }

        // Mostrar detalles del mod en un modal
        async function showModDetails(modId) {
            const modal = new bootstrap.Modal(document.getElementById('modDetailsModal'));
            const modalTitle = document.getElementById('modDetailsTitle');
            const modalBody = document.getElementById('modDetailsBody');
            const modDownloadLink = document.getElementById('modDownloadLink');

            try {
                // Mostrar carga
                modalBody.innerHTML = `
                    < div class="text-center py-4" >
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Cargando...</span>
                        </div>
                    </ >
                    `;

                // Obtener detalles del mod
                const modDetails = await modrinthApiPath("project", modId);

                // Formatear la fecha
                const date = new Date(modDetails.updated || modDetails.published);
                const formattedDate = date.toLocaleDateString('es-ES', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });

                // Crear el contenido del modal
                modalTitle.textContent = modDetails.title || 'Detalles del Mod';
                modalBody.innerHTML = `
                    < div class="row" >
                        <div class="col-md-4 text-center mb-3 mb-md-0">
                            <img src="${modDetails.icon_url || 'https://via.placeholder.com/200'}" 
                                 class="img-fluid rounded mb-3" 
                                 alt="${modDetails.title || 'Icono del mod'}"
                                 style="max-height: 200px; width: auto;">
                            <div class="d-grid gap-2">
                                <a href="https://modrinth.com/mod/${modDetails.slug || modDetails.id}" 
                                   target="_blank" 
                                   class="btn btn-primary">
                                    <i class="bi bi-box-arrow-up-right"></i> Ver en Modrinth
                                </a>
                            </div>
                        </div>
                        <div class="col-md-8">
                            <p>${modDetails.description || 'Sin descripción disponible.'}</p>
                            
                            <div class="row g-2 mb-3">
                                <div class="col-6">
                                    <div class="p-2 bg-dark rounded">
                                        <div class="text-muted small">Descargas</div>
                                        <div class="fw-bold">${modDetails.downloads ? modDetails.downloads.toLocaleString() : 'N/A'}</div>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="p-2 bg-dark rounded">
                                        <div class="text-muted small">Última actualización</div>
                                        <div class="fw-bold">${formattedDate}</div>
                                    </div>
                                </div>
                                ${modDetails.license ? `
                                <div class="col-6">
                                    <div class="p-2 bg-dark rounded">
                                        <div class="text-muted small">Licencia</div>
                                        <div class="fw-bold">${modDetails.license.name || modDetails.license.id || 'N/A'}</div>
                                    </div>
                                </div>` : ''}
                                <div class="col-6">
                                    <div class="p-2 bg-dark rounded">
                                        <div class="text-muted small">Tipo</div>
                                        <div class="fw-bold">${modDetails.project_type || 'Mod'}</div>
                                    </div>
                                </div>
                            </div>
                            
                            ${modDetails.versions && modDetails.versions.length > 0 ? `
                            <h6 class="mt-3 mb-2">Versiones soportadas</h6>
                            <div class="d-flex flex-wrap gap-1 mb-3">
                                ${modDetails.versions.slice(0, 10).map(v =>
                    `<span class="badge bg-secondary">${v}</span>`
                ).join('')}
                                ${modDetails.versions.length > 10 ?
                            `<span class="badge bg-dark">+${modDetails.versions.length - 10} más</span>` : ''}
                            </div>` : ''}
                            
                            ${modDetails.categories && modDetails.categories.length > 0 ? `
                            <h6 class="mt-3 mb-2">Categorías</h6>
                            <div class="d-flex flex-wrap gap-1">
                                ${modDetails.categories.map(cat =>
                                `<span class="badge bg-info text-dark">${cat}</span>`
                            ).join('')}
                            </div>` : ''}
                        </div>
                    </ >
                    `;

                // Actualizar enlace de descarga
                modDownloadLink.href = `https://modrinth.com/mod/${modDetails.slug || modDetails.id}/version/latest`;

            } catch (error) {
                console.error('Error cargando detalles del mod:', error);
                modalBody.innerHTML = `
                    <div class="alert alert-danger">
                        <i class="bi bi-exclamation-triangle-fill"></i> Error al cargar los detalles del mod: ${error.message}
                    </div>
                `;
                modDownloadLink.style.display = 'none';
            }

            modal.show();
        }

        // Seleccionar un mod de los resultados
        function selectMod(modIndex, modId) {
            const mod = localMods[modIndex];
            const modElement = document.querySelector(`#localModsList [data-mod-index="${modIndex}"]`);
            const modData = searchResults[modIndex].find(m => m.project_id === modId);

            if (modData) {
                // Actualizar la interfaz para mostrar que el mod está seleccionado
                document.querySelectorAll('#searchResults .active').forEach(el => {
                    el.classList.remove('active');
                });
                document.querySelector(`#searchResults [data-mod-id="${modId}"]`).classList.add('active');

                // Aquí puedes agregar la lógica para guardar la selección
                console.log(`Mod seleccionado: ${mod.name} -> ${modData.title} (${modData.project_id})`);

                // Mostrar notificación de éxito
                const toast = document.createElement('div');
                toast.className = 'position-fixed bottom-0 end-0 m-3 toast show';
                toast.role = 'alert';
                toast.setAttribute('aria-live', 'assertive');
                toast.setAttribute('aria-atomic', 'true');
                toast.style.zIndex = '1100';
                toast.innerHTML = `
                    <div class="toast-header bg-success text-white">
                        <strong class="me-auto">Mod seleccionado</strong>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast" aria-label="Close"></button>
                    </div>
                    <div class="toast-body">
                        <div class="d-flex align-items-center">
                            <i class="bi bi-check-circle-fill text-success me-2"></i>
                            <div>
                                <div>${modData.title}</div>
                                <small class="text-muted">${mod.fileName}</small>
                            </div>
                        </div>
                    </div>
                `;
                document.body.appendChild(toast);

                // Eliminar la notificación después de 3 segundos
                setTimeout(() => {
                    toast.classList.remove('show');
                    setTimeout(() => toast.remove(), 150);
                }, 3000);
            }
        }

        // Agregar estilos dinámicos
        const style = document.createElement('style');
        style.textContent = `
            .toast {
                opacity: 0;
                transition: opacity 0.15s ease-in-out;
            }
            .toast.show {
                opacity: 1;
            }
            .bg-purple {
                background-color: #6f42c1;
                color: white;
            }
            .bg-orange {
                background-color: #fd7e14;
                color: white;
            }
            .list-group-item {
                cursor: pointer;
                transition: all 0.2s;
            }
            .list-group-item:hover {
                background-color: rgba(255, 255, 255, 0.05);
            }
            .list-group-item.active {
                background-color: rgba(13, 110, 253, 0.2);
                border-color: rgba(13, 110, 253, 0.5);
                color: white;
            }
            .btn-outline-primary {
                --bs-btn-hover-bg: rgba(13, 110, 253, 0.1);
                --bs-btn-active-bg: rgba(13, 110, 253, 0.2);
            }
        `;
        document.head.appendChild(style);
    </script>

</body>

</html>